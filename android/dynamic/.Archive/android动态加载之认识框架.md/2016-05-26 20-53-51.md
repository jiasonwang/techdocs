## android动态加载之认识框架
了解android动态加载的过程，首先需要对android的部分框架进行了解，以下对Android的Activity的生命周期进行讲解，然后看如何hook这个过程的细节。
简单概念解释
```table
App一侧
java类型  |   职责解释
ActivityThread  |   Apk运行后每个进程都会生成一个该对象(它有java经典的main方法，算是java层进程开启的地方)，算是和框架交互的核心对象。这个看源码的类注释就可以知道。
IApplicationThread  |   一个binder对象接口，用于和android服务框架使用该接口和app进行通信，比如AMS通过该接口来通知app进行activity的生命周期管理。
Instrumentation | 这个类，在android测试中非常熟悉，其实它的方法就是提供创建四大组件等对象用的，那么一当你mock了这个对象，那么就可以对系统进行测试了，而从动态加载的角度讲，你要是替换了这个对象，那么你就可以为系统提供指定的act，service对象了，最最重要的是这个类是我们可以继承访问的。
LoadedApk   | 代表了Apk文件的所有信息，包括资源，类加载器等。并且有一个构造Application实例的方法。
ContextImpl | 继承并实现了大部分的Context，Activity里的很多操作都最终转发至这里去做，使用了ContextThemeWrapper的代理模式。impl这个类实现了大部分的资源，文件相关的方法，以及与别的界面，服务的联系（启动其他act），这就是一个app运行的“上下文”本质特征。而且，显然这个对象的实例全进程只要一个就够了。所以在代理模式中，无论是act，service还是application，它们的大部分实现都会委托给impl。
ActivityClientRecord | AMS查询，验证，并建立act的信息后返回给客户端的信息都会被记录到这个对象中，其中有一个IBinder作为token来唯一标识这个act。
Android系统一侧
ActivityManagerNative   | 典型的android binder通信base类，作为服务端的几类以及为客户端提供代理类。主要业务是创建启动act（其他生命周期是通过IApplicationThread调度的），app等。
ActivityManagerService |   android系统管理act的服务，简称AMS，通过IApplicationThread和act进行交互。包括创建app的进程，act，调度act生命周期。
ActivityStackSupervisor | Android act stack的管理类，维护stack，task的生成，销毁，为act的生成做准备，比如启动模式，在哪个task，是否要新建task，查找在哪个task等等，逻辑比较复杂。
ActivityStack | 单一的一个act堆，里面以Task为基础进行管理act。
TaskRecord | 记录Task实例，里面记录着这个task的关联ActivityRecord列表。
ActivityRecord | android系统侧记录当前存在的act实例。
```
上面的这些概念几乎涵盖了所有Acivity创建和启动的java层，包括app进程和系统框架进程AMS所做的工作，简单描述就是AMS通过binder接口如提线木偶般操控app端的act的生命周期，然后act会做对应的反馈。下面开始开车了：
##开启一个Activity
启动一个act的方法，无非就是两种，一个种是在Launcher界面，单击某个app的icon，然后进入到默认启动的界面（前提是之前没有启动过），还有就是app内部的启动。无论是哪种方式，最终都会使用到Instrumentation.execStartActivity方法
Activity.startActivity